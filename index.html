<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calculadora de Inversión Avanzada</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      /* Esta regla aplica el modo oscuro al popup nativo del calendario */
      html.dark input[type="date"] {
        color-scheme: dark;
      }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "recharts": "https://aistudiocdn.com/recharts@^3.3.0",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.552.0"
  }
}
</script>
</head>
<body class="bg-slate-50 dark:bg-[#0A0E17]">
    <div id="root"></div>
    <script type="module">
// <![CDATA[
import React, { useState, useEffect, useCallback } from 'react';
import ReactDOM from 'react-dom/client';
import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';
import { Sun, Moon, Calculator, Target, History, Plus, Trash2, HelpCircle, Copy, BarChart3, Eraser, Check, List, Clipboard } from 'lucide-react';

// --- Inlined from utils/formatters.ts ---
const formatCurrency = (value, minFractionDigits = 2) => {
    return new Intl.NumberFormat('es-MX', {
        style: 'currency',
        currency: 'MXN',
        minimumFractionDigits: minFractionDigits,
        maximumFractionDigits: 2,
    }).format(value);
};

const formatDate = (dateString) => {
    const date = new Date(dateString.includes('T') ? dateString : dateString + 'T00:00:00');
    return new Intl.DateTimeFormat('es-ES', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
    }).format(date);
};

// --- Inlined from hooks/useLocalStorage.ts ---
function useLocalStorage(key, initialValue) {
    const [storedValue, setStoredValue] = useState(() => {
        try {
            const item = window.localStorage.getItem(key);
            return item ? JSON.parse(item) : initialValue;
        } catch (error) {
            console.error(error);
            return initialValue;
        }
    });

    useEffect(() => {
        try {
            const valueToStore = JSON.stringify(storedValue);
            window.localStorage.setItem(key, valueToStore);
        } catch (error) {
            console.error(error);
        }
    }, [key, storedValue]);

    return [storedValue, setStoredValue];
}


// --- Inlined from components/shared/Card.tsx ---
const Card = ({ children, className = '' }) => {
    return (
        React.createElement('div', { className: `bg-white dark:bg-[#1A1F35] p-6 md:p-8 rounded-2xl border border-slate-200 dark:border-[#2D3548] shadow-lg shadow-slate-500/5 dark:shadow-emerald-500/5 ${className}` },
            children
        )
    );
};

// --- Inlined from components/shared/InputGroup.tsx ---
const InputGroup = ({ label, tooltip, children }) => {
    return (
        React.createElement('div', { className: "space-y-2" },
            React.createElement('label', { className: "text-sm font-semibold text-slate-700 dark:text-slate-300 flex items-center gap-1.5" },
                label,
                tooltip && (
                    React.createElement('span', { className: "group relative" },
                        React.createElement(HelpCircle, { size: 16, className: "text-slate-400 cursor-help" }),
                        React.createElement('span', { className: "absolute bottom-full mb-2 w-52 bg-slate-800 text-white text-xs rounded py-1 px-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none left-1/2 -translate-x-1/2" },
                            tooltip
                        )
                    )
                )
            ),
            React.Children.map(children, child => {
                if (React.isValidElement(child)) {
                    return React.cloneElement(child, {
                        className: `${child.props.className || ''} bg-slate-100 dark:bg-[#0A0E17] border-2 border-slate-200 dark:border-slate-700 rounded-lg p-3 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition`
                    });
                }
                return child;
            })
        )
    );
};

// --- Inlined from components/results/SummaryCard.tsx ---
const SummaryCard = ({ label, value, subValue, highlight = false }) => {
    return (
        React.createElement('div', { className: "bg-slate-100 dark:bg-[#0A0E17] p-4 rounded-lg text-center border border-slate-200 dark:border-slate-700" },
            React.createElement('p', { className: "text-xs font-semibold uppercase text-slate-500 dark:text-slate-400 tracking-wider" }, label),
            React.createElement('p', { className: `text-2xl md:text-3xl font-bold my-1 ${highlight ? 'bg-clip-text text-transparent bg-gradient-to-r from-emerald-400 to-blue-500' : 'text-slate-800 dark:text-slate-100'}` },
                formatCurrency(value)
            ),
            subValue && React.createElement('p', { className: `text-xs font-semibold ${highlight ? 'text-emerald-500 dark:text-emerald-400' : 'text-slate-500'}` }, subValue)
        )
    );
};

// --- Inlined from components/results/InvestmentChart.tsx ---
const CustomTooltip = ({ active, payload, label }) => {
    if (active && payload && payload.length) {
        const principal = payload.find((p) => p.dataKey === 'principal')?.value || 0;
        const earnings = payload.find((p) => p.dataKey === 'earnings')?.value || 0;
        const total = principal + earnings;
        return (
            React.createElement('div', { className: "bg-white dark:bg-[#1A1F35] p-3 rounded-lg border border-slate-200 dark:border-slate-700 shadow-lg text-sm" },
                React.createElement('p', { className: "label font-semibold text-slate-800 dark:text-slate-200 mb-2" }, `${label}`),
                React.createElement('p', { className: "intro text-slate-600 dark:text-slate-300 flex items-center" },
                    React.createElement('span', { className: "inline-block w-3 h-3 rounded-full bg-[#3B82F6] mr-2" }),
                    `Capital: ${formatCurrency(principal)}`
                ),
                React.createElement('p', { className: "intro text-slate-600 dark:text-slate-300 flex items-center" },
                    React.createElement('span', { className: "inline-block w-3 h-3 rounded-full bg-[#00FFA3] mr-2" }),
                    `Ganancias: ${formatCurrency(earnings)}`
                ),
                React.createElement('hr', { className: "my-2 border-slate-200 dark:border-slate-700" }),
                React.createElement('p', { className: "font-bold text-slate-800 dark:text-slate-200" },
                    `Total: ${formatCurrency(total)}`
                )
            )
        );
    }
    return null;
};

const InvestmentChart = ({ data }) => {
    // const [theme] = useLocalStorage('theme', 'dark'); // Ya no es necesario, siempre es 'dark'
    const isDark = true; // Forzado a dark

    return (
        React.createElement(ResponsiveContainer, { width: "100%", height: "100%" },
            React.createElement(AreaChart, {
                data: data,
                margin: { top: 5, right: 20, left: 20, bottom: 5 }
            },
                React.createElement(CartesianGrid, { strokeDasharray: "3 3", stroke: isDark ? '#2D3548' : '#e2e8f0' }),
                React.createElement(XAxis, { dataKey: "name", stroke: isDark ? '#94A3B8' : '#64748B', tick: { fontSize: 12 } }),
                React.createElement(YAxis, {
                    stroke: isDark ? '#94A3B8' : '#64748B',
                    tickFormatter: (value) => formatCurrency(value, 0),
                    tick: { fontSize: 12 },
                    width: 80
                }),
                React.createElement(Tooltip, { content: React.createElement(CustomTooltip) }),
                React.createElement(Legend, { wrapperStyle: { fontSize: '14px' } }),
                React.createElement(Area, { type: "monotone", dataKey: "principal", stackId: "1", stroke: "#3B82F6", fill: "#3B82F6", fillOpacity: 0.6, name: "Capital Total" }),
                React.createElement(Area, { type: "monotone", dataKey: "earnings", stackId: "1", stroke: "#00FFA3", fill: "#00FFA3", fillOpacity: 0.6, name: "Ganancias Totales" })
            )
        )
    );
};

// --- Inlined from components/results/InvestmentTable.tsx ---
const InvestmentTable = ({ periods }) => {
    return (
        React.createElement('div', { className: "h-full w-full overflow-auto" },
            React.createElement('table', { className: "w-full text-sm text-left text-slate-500 dark:text-slate-400" },
                React.createElement('thead', { className: "text-xs text-slate-700 uppercase bg-slate-50 dark:bg-slate-800 dark:text-slate-400 sticky top-0" },
                    React.createElement('tr', null,
                        React.createElement('th', { scope: "col", className: "px-4 py-3" }, "Período"),
                        React.createElement('th', { scope: "col", className: "px-4 py-3" }, "Fecha"),
                        React.createElement('th', { scope: "col", className: "px-4 py-3 text-right" }, "Inicio"),
                        React.createElement('th', { scope: "col", className: "px-4 py-3 text-right" }, "Aporte"),
                        React.createElement('th', { scope: "col", className: "px-4 py-3 text-right" }, "Ganancia"),
                        React.createElement('th', { scope: "col", className: "px-4 py-3 text-right" }, "Comisión"),
                        React.createElement('th', { scope: "col", className: "px-4 py-3 text-right" }, "Retiro"),
                        React.createElement('th', { scope: "col", className: "px-4 py-3 text-right" }, "Final")
                    )
                ),
                React.createElement('tbody', null,
                    periods.map((p) => (
                        React.createElement('tr', { key: p.period, className: "bg-white dark:bg-[#1A1F35] border-b dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800/50" },
                            React.createElement('td', { className: "px-4 py-3 font-medium text-slate-900 dark:text-white" }, p.period),
                            React.createElement('td', { className: "px-4 py-3" }, formatDate(p.date)),
                            React.createElement('td', { className: "px-4 py-3 text-right" }, formatCurrency(p.initialCapital)),
                            React.createElement('td', { className: "px-4 py-3 text-right text-sky-500" }, p.contribution > 0 ? `+${formatCurrency(p.contribution)}` : '-'),
                            React.createElement('td', { className: "px-4 py-3 text-right text-emerald-500" }, `+${formatCurrency(p.earnings)}`),
                            React.createElement('td', { className: "px-4 py-3 text-right text-orange-500" }, p.taxes > 0 ? `-${formatCurrency(p.taxes)}` : '-'),
                            React.createElement('td', { className: "px-4 py-3 text-right text-orange-500" }, p.withdrawal > 0 ? `-${formatCurrency(p.withdrawal)}` : '-'),
                            React.createElement('td', { className: "px-4 py-3 text-right font-semibold text-slate-900 dark:text-white" }, formatCurrency(p.finalCapital))
                        )
                    ))
                )
            )
        )
    );
};

// --- Inlined from components/results/ResultsDisplay.tsx ---
const ResultsDisplay = ({ results }) => {
    const [view, setView] = useState('chart');
    const [isCopied, setIsCopied] = useState(false);

    const handleExport = () => {
        const { params, periods, finalCapital, roi, totalContributions, totalEarnings, totalTaxes, totalWithdrawals } = results;
        const formatLine = (label, value) => `${label}: ${value}`;
        let exportString = `📊 *Resumen de Proyección de Inversión*\n\n`;
        exportString += `*Parámetros Iniciales*\n`;
        exportString += `${formatLine('💰 Monto Inicial', formatCurrency(params.initialAmount))}\n`;
        exportString += `${formatLine('📅 Fecha de Inicio', formatDate(params.startDate))}\n`;
        exportString += `${formatLine('⏳ Duración', `${params.duration} períodos`)}\n`;
        if (params.withdrawalPercent > 0) {
            exportString += `${formatLine('💸 % de Retiro', `${params.withdrawalPercent}%`)}\n`;
            if (params.withdrawalStartDate) {
                exportString += `${formatLine('🗓️ Inicio Retiros', formatDate(params.withdrawalStartDate))}\n`;
            }
        }
        if (params.contributions.length > 0) {
            exportString += `\n*Aportes Adicionales:*\n`;
            params.contributions.forEach(c => {
                exportString += `  - ${formatCurrency(c.amount)} el ${formatDate(c.date)}\n`;
            });
        }
        exportString += `\n`;
        exportString += `*Resultados de la Proyección*\n`;
        exportString += `${formatLine('🏦 Capital Final', formatCurrency(finalCapital))}\n`;
        exportString += `${formatLine('📈 ROI', `${roi.toFixed(2)}%`)}\n`;
        exportString += `${formatLine('💸 Total Invertido', formatCurrency(params.initialAmount + totalContributions))}\n`;
        exportString += `${formatLine('💹 Ganancias Netas', formatCurrency(totalEarnings - totalTaxes))}\n`;
        exportString += `${formatLine('🏧 Retiros Totales', formatCurrency(totalWithdrawals))}\n`;
        exportString += `\n`;
        exportString += `*Detalle por Período*\n`;
        exportString += `--------------------------------\n`;
        periods.forEach(p => {
            exportString += `*Período ${p.period}* (${formatDate(p.date)})\n`;
            exportString += `  Inicio: ${formatCurrency(p.initialCapital)}\n`;
            if (p.contribution > 0) exportString += `  Aporte: +${formatCurrency(p.contribution)}\n`;
            exportString += `  Ganancia: +${formatCurrency(p.earnings)}\n`;
            if (p.taxes > 0) exportString += `  Comisión: -${formatCurrency(p.taxes)}\n`;
            if (p.withdrawal > 0) exportString += `  Retiro: -${formatCurrency(p.withdrawal)}\n`;
            exportString += `  *Final: ${formatCurrency(p.finalCapital)}*\n`;
            exportString += `--------------------------------\n`;
        });
        navigator.clipboard.writeText(exportString.trim()).then(() => {
            setIsCopied(true);
            setTimeout(() => setIsCopied(false), 2500);
        });
    };

    return (
        React.createElement(Card, { className: "mt-8 transition-all duration-500 ease-in-out" },
            React.createElement('h2', { className: "text-2xl font-bold text-center mb-6 text-slate-900 dark:text-slate-100" }, "Resultados de la Proyección"),
            React.createElement('div', { className: "grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8" },
                React.createElement(SummaryCard, {
                    label: "Total Invertido",
                    value: results.initialAmount + results.totalContributions,
                    subValue: "Inicial + Aportes"
                }),
                React.createElement(SummaryCard, {
                    label: "Capital Final",
                    value: results.finalCapital,
                    subValue: `+${results.roi.toFixed(2)}% ROI`,
                    highlight: true
                }),
                React.createElement(SummaryCard, {
                    label: "Ganancias Netas",
                    value: results.totalEarnings - results.totalTaxes,
                    subValue: results.totalTaxes > 0 ? `Comisiones: ${formatCurrency(results.totalTaxes)}` : undefined
                }),
                React.createElement(SummaryCard, {
                    label: "Retiros Totales",
                    value: results.totalWithdrawals
                })
            ),
            React.createElement('div', { className: "mb-6 text-center" },
                React.createElement('button', {
                    onClick: handleExport,
                    className: "bg-emerald-500/10 dark:bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 border border-emerald-500/20 hover:bg-emerald-500/20 dark:hover:bg-emerald-500/20 font-semibold py-2 px-5 rounded-lg transition-all duration-300 flex items-center gap-2 mx-auto"
                },
                    isCopied ? React.createElement(Check, { size: 18 }) : React.createElement(Clipboard, { size: 18 }),
                    isCopied ? '¡Copiado!' : 'Exportar Datos'
                )
            ),
            React.createElement('div', { className: "flex justify-center mb-4" },
              React.createElement('div', { className: "flex space-x-1 bg-slate-200 dark:bg-[#0A0E17] p-1 rounded-lg" },
                React.createElement('button', {
                  onClick: () => setView('chart'),
                  className: `px-4 py-1.5 text-sm font-semibold rounded-md flex items-center gap-2 transition-colors duration-200 ${
                    view === 'chart' ? 'bg-white dark:bg-slate-700 text-slate-800 dark:text-white' : 'text-slate-500 dark:text-slate-400 hover:bg-slate-300/50 dark:hover:bg-slate-600/50'
                  }`
                },
                  React.createElement(BarChart3, { size: 16 }), " Gráfico"
                ),
                React.createElement('button', {
                  onClick: () => setView('table'),
                  className: `px-4 py-1.5 text-sm font-semibold rounded-md flex items-center gap-2 transition-colors duration-200 ${
                    view === 'table' ? 'bg-white dark:bg-slate-700 text-slate-800 dark:text-white' : 'text-slate-500 dark:text-slate-400 hover:bg-slate-300/50 dark:hover:bg-slate-600/50'
                  }`
                },
                  React.createElement(List, { size: 16 }), " Tabla"
                )
              )
            ),
            React.createElement('div', { className: "h-96 w-full" },
                view === 'chart' ?
                    React.createElement(InvestmentChart, { data: results.chartData }) :
                    React.createElement(InvestmentTable, { periods: results.periods })
            )
        )
    );
};

// --- Inlined from components/Header.tsx ---
const Header = () => {
    // El botón de cambio de tema y la lógica 'toggleTheme' se han eliminado.
    return (
        React.createElement('header', { className: "text-center mb-8 md:mb-12 relative" },
            // El botón de cambio de tema ha sido eliminado
            React.createElement('h1', { className: "text-3xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-emerald-400 to-blue-500 mb-2" },
                "Calculadora de Inversión Avanzada"
            ),
            React.createElement('p', { className: "text-md md:text-lg text-slate-600 dark:text-slate-400" },
                "Proyecta tus inversiones con aportes flexibles."
            )
        )
    );
};

// --- Inlined from components/Tabs.tsx ---
const tabConfig = [
    { id: 'calculator', label: 'Calculadora', icon: React.createElement(Calculator, { size: 18 }) },
    { id: 'goal', label: 'Planificador de Metas', icon: React.createElement(Target, { size: 18 }) },
    { id: 'history', label: 'Historial', icon: React.createElement(History, { size: 18 }) },
];

const Tabs = ({ activeTab, setActiveTab }) => {
    return (
        React.createElement('div', { className: "flex justify-center mb-6 md:mb-8" },
            React.createElement('div', { className: "flex space-x-2 bg-slate-200 dark:bg-[#1A1F35] p-1.5 rounded-xl border border-transparent dark:border-slate-700" },
                tabConfig.map((tab) => (
                    React.createElement('button', {
                        key: tab.id,
                        onClick: () => setActiveTab(tab.id),
                        className: `px-4 py-2 text-sm font-semibold rounded-lg flex items-center gap-2 transition-colors duration-300 ${
                            activeTab === tab.id
                                ? 'bg-white dark:bg-gradient-to-r dark:from-emerald-500 dark:to-blue-500 text-slate-800 dark:text-white shadow'
                                : 'text-slate-600 dark:text-slate-400 hover:bg-slate-300/60 dark:hover:bg-slate-600/90'
                        }`
                    },
                        tab.icon,
                        React.createElement('span', { className: "hidden sm:inline" }, tab.label)
                    )
                ))
            )
        )
    );
};

// --- Inlined from components/DonationModal.tsx ---
const DonationModal = ({ isOpen, onClose }) => {
    const [copied, setCopied] = useState(false);
    const donationAddress = '0x2198017F4De50375847cdC48848A21F677714ecb';

    if (!isOpen) return null;

    const handleCopy = () => {
        navigator.clipboard.writeText(donationAddress);
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
    };

    return (
        React.createElement('div', {
            className: "fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",
            onClick: onClose
        },
            React.createElement('div', {
                className: "bg-white dark:bg-[#1A1F35] rounded-2xl p-6 md:p-8 max-w-md w-full border-2 border-emerald-500 shadow-2xl shadow-emerald-500/10",
                onClick: e => e.stopPropagation()
            },
                React.createElement('h3', { className: "text-2xl font-bold text-center mb-2" }, "Donaciones BNB | BEP20"),
                React.createElement('p', { className: "text-center text-slate-500 dark:text-slate-400 mb-6" }, "IG: @Abrinay_"),
                React.createElement('div', { className: "bg-slate-100 dark:bg-[#0A0E17] p-4 rounded-lg font-mono text-emerald-500 text-center break-all text-sm border border-slate-200 dark:border-slate-700" },
                    donationAddress
                ),
                React.createElement('div', { className: "flex gap-4 mt-6" },
                    React.createElement('button', {
                        onClick: handleCopy,
                        className: "flex-1 w-full justify-center bg-slate-200 dark:bg-[#2D3548] text-slate-600 dark:text-slate-300 border border-slate-300 dark:border-[#2D3548] hover:border-slate-400 dark:hover:border-slate-500 font-semibold py-3 px-6 rounded-lg transition-all duration-300 flex items-center gap-2"
                    },
                        copied ? React.createElement(Check, { size: 20, className: "text-emerald-500" }) : React.createElement(Copy, { size: 20 }),
                        copied ? '¡Copiado!' : 'Copiar Dirección'
                    ),
                    React.createElement('button', {
                        onClick: onClose,
                        className: "flex-1 w-full justify-center text-white bg-gradient-to-r from-emerald-500 to-blue-500 hover:from-emerald-600 hover:to-blue-600 font-semibold py-3 px-6 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg"
                    },
                        "Cerrar"
                    )
                )
            )
        )
    );
};

// --- Inlined from components/CalculatorTab.tsx ---
const INTEREST_RATE = 0.24; // 24% per period
const DAYS_PER_PERIOD = 28;

const addDaysToDate = (dateStr, days) => {
    if (!dateStr) return '';
    const date = new Date(dateStr + 'T00:00:00');
    date.setDate(date.getDate() + days);
    return date.toISOString().split('T')[0];
};

const CalculatorTab = ({ addToHistory, historyToLoad, onHistoryLoaded }) => {
    const [initialAmount, setInitialAmount] = useState('1000');
    const [startDate, setStartDate] = useState(new Date().toISOString().split('T')[0]);
    const [duration, setDuration] = useState(12);
    const [contributions, setContributions] = useState([
        { id: crypto.randomUUID(), date: '', amount: '' }
    ]);
    const [withdrawalPercent, setWithdrawalPercent] = useState('0');
    const [withdrawalStartDate, setWithdrawalStartDate] = useState('');
    const [considerTaxes, setConsiderTaxes] = useState(false);
    const [results, setResults] = useState(null);

    const minWithdrawalDate = addDaysToDate(startDate, DAYS_PER_PERIOD);

    useEffect(() => {
        if (!withdrawalStartDate || new Date(withdrawalStartDate) < new Date(minWithdrawalDate)) {
            setWithdrawalStartDate(minWithdrawalDate);
        }
    }, [startDate, minWithdrawalDate]);

    useEffect(() => {
        if (historyToLoad) {
            const { params } = historyToLoad;
            setInitialAmount(params.initialAmount);
            setStartDate(params.startDate);
            setDuration(params.duration);
            setWithdrawalPercent(params.withdrawalPercent);
            setWithdrawalStartDate(params.withdrawalStartDate || addDaysToDate(params.startDate, DAYS_PER_PERIOD));
            setConsiderTaxes(params.considerTaxes);
            setContributions(params.contributions.map(c => ({...c, id: crypto.randomUUID() })));
            setResults(null);
            onHistoryLoaded();
        }
    }, [historyToLoad, onHistoryLoaded]);

    const handleAddContribution = () => {
        setContributions([...contributions, { id: crypto.randomUUID(), date: '', amount: '' }]);
    };

    const handleRemoveContribution = (id) => {
        setContributions(contributions.filter(c => c.id !== id));
    };

    const handleContributionChange = (id, field, value) => {
        setContributions(
            contributions.map(c => c.id === id ? { ...c, [field]: value } : c)
        );
    };
    
    const handleReset = () => {
        const today = new Date().toISOString().split('T')[0];
        setInitialAmount('1000');
        setStartDate(today);
        setDuration(12);
        setContributions([{ id: crypto.randomUUID(), date: '', amount: '' }]);
        setWithdrawalPercent('0');
        setWithdrawalStartDate(addDaysToDate(today, DAYS_PER_PERIOD));
        setConsiderTaxes(false);
        setResults(null);
    }

    const handleCalculate = () => {
        const initial = parseFloat(initialAmount) || 0;
        if (initial <= 0) {
            alert('Por favor, introduce un monto inicial válido.');
            return;
        }

        const validContributions = contributions
            .map(c => ({ date: c.date, amount: parseFloat(c.amount) || 0 }))
            .filter(c => c.date && c.amount > 0)
            .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());

        let currentCapital = initial;
        let totalContributions = 0;
        let totalWithdrawals = 0;
        let totalTaxes = 0;
        let totalEarnings = 0;

        const calculationPeriods = [];
        const chartData = [{ name: 'Inicio', principal: initial, earnings: 0 }];
        const taxRate = considerTaxes ? 0.10 : 0;
        
        let currentDate = new Date(startDate + 'T00:00:00');
        const withdrawalStartDateObj = parseFloat(withdrawalPercent) > 0 ? new Date(withdrawalStartDate + 'T00:00:00') : null;

        for (let period = 1; period <= duration; period++) {
            const periodStartDate = new Date(currentDate);
            currentDate.setDate(currentDate.getDate() + DAYS_PER_PERIOD);
            const periodEndDate = new Date(currentDate);
            const initialCapitalForPeriod = currentCapital;

            let contributionsThisPeriod = 0;
            validContributions.forEach(c => {
                const contributionDate = new Date(c.date + 'T00:00:00');
                if (contributionDate >= periodStartDate && contributionDate < periodEndDate) {
                    contributionsThisPeriod += c.amount;
                }
            });
            currentCapital += contributionsThisPeriod;
            totalContributions += contributionsThisPeriod;

            const earnings = currentCapital * INTEREST_RATE;
            totalEarnings += earnings;
            const taxes = earnings * taxRate;
            totalTaxes += taxes;
            const netEarnings = earnings - taxes;

            const applyWithdrawal = withdrawalStartDateObj && periodEndDate >= withdrawalStartDateObj;
            const withdrawal = applyWithdrawal ? netEarnings * (parseFloat(withdrawalPercent) / 100) : 0;
            totalWithdrawals += withdrawal;

            const reinvested = netEarnings - withdrawal;
            currentCapital += reinvested;

            calculationPeriods.push({
                period,
                date: periodEndDate.toISOString().split('T')[0],
                initialCapital: initialCapitalForPeriod,
                contribution: contributionsThisPeriod,
                earnings,
                taxes,
                withdrawal,
                finalCapital: currentCapital,
            });
            
            const totalInvested = initial + totalContributions;
            const totalEarningsAtPeriodEnd = currentCapital - totalInvested;
            chartData.push({
                name: `P${period}`,
                principal: totalInvested,
                earnings: totalEarningsAtPeriodEnd > 0 ? totalEarningsAtPeriodEnd : 0,
            });
        }

        const finalCapital = currentCapital;
        const totalInvested = initial + totalContributions;
        const roi = totalInvested > 0 ? ((finalCapital - totalInvested) / totalInvested) * 100 : 0;

        const newResult = {
            params: {
                initialAmount: initial,
                startDate,
                duration,
                withdrawalPercent: parseFloat(withdrawalPercent),
                withdrawalStartDate: parseFloat(withdrawalPercent) > 0 ? withdrawalStartDate : undefined,
                considerTaxes,
                contributions: validContributions
            },
            periods: calculationPeriods,
            initialAmount: initial,
            totalContributions,
            finalCapital,
            totalEarnings: totalEarnings,
            totalWithdrawals,
            totalTaxes,
            roi,
            chartData,
        };
        setResults(newResult);
        
        addToHistory({
            id: crypto.randomUUID(),
            date: new Date().toISOString(),
            params: {
                initialAmount,
                startDate,
                duration,
                withdrawalPercent,
                withdrawalStartDate: parseFloat(withdrawalPercent) > 0 ? withdrawalStartDate : undefined,
                considerTaxes,
                contributions: contributions.map(({id, ...rest}) => rest)
            },
            result: {
                finalCapital: newResult.finalCapital,
                roi: newResult.roi
            }
        });
    };
    
    return (
        React.createElement('div', { id: "calculator-tab", className: "space-y-6" },
            React.createElement(Card, null,
                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-6" },
                    React.createElement(InputGroup, { label: "Monto Inicial", tooltip: "La cantidad con la que comienzas tu inversión." },
                        React.createElement('input', { type: "number", value: initialAmount, onChange: e => setInitialAmount(e.target.value), placeholder: "Ej: 1000", className: "w-full" })
                    ),
                    React.createElement(InputGroup, { label: "Fecha de Inicio", tooltip: "La fecha en que comienza tu inversión." },
                        React.createElement('input', { type: "date", value: startDate, onChange: e => setStartDate(e.target.value), className: "w-full" })
                    ),
                    React.createElement(InputGroup, { label: "Períodos (de 28 días)", tooltip: "La duración total de la proyección de tu inversión." },
                        React.createElement('select', { value: duration, onChange: e => setDuration(Number(e.target.value)), className: "w-full" },
                            React.createElement('option', { value: "6" }, "6 Períodos (~6 meses)"),
                            React.createElement('option', { value: "12" }, "12 Períodos (~1 año)"),
                            React.createElement('option', { value: "18" }, "18 Períodos (~1.5 años)"),
                            React.createElement('option', { value: "24" }, "24 Períodos (~2 años)"),
                            React.createElement('option', { value: "36" }, "36 Períodos (~3 años)")
                        )
                    ),
                    React.createElement(InputGroup, { label: "% de Retiro por Período", tooltip: "Porcentaje de las ganancias a retirar cada período." },
                        React.createElement('input', { type: "number", value: withdrawalPercent, onChange: e => setWithdrawalPercent(e.target.value), min: "0", max: "100", placeholder: "Ej: 50", className: "w-full" })
                    ),
                    parseFloat(withdrawalPercent) > 0 && (
                        React.createElement(InputGroup, { label: "Fecha Inicio Retiros", tooltip: `Los retiros no pueden empezar antes del primer período (${formatDate(minWithdrawalDate)}).` },
                            React.createElement('input', {
                                type: "date",
                                value: withdrawalStartDate,
                                onChange: e => setWithdrawalStartDate(e.target.value),
                                min: minWithdrawalDate,
                                className: "w-full"
                            })
                        )
                    )
                ),
                React.createElement('div', { className: "mt-6 border-t border-slate-200 dark:border-slate-700 pt-6" },
                    React.createElement('h3', { className: "text-lg font-semibold mb-3 flex items-center gap-2" },
                        "Aportes Adicionales",
                        React.createElement('span', { className: "group relative" },
                            React.createElement(HelpCircle, { size: 18, className: "text-slate-400 cursor-help" }),
                            React.createElement('span', { className: "absolute bottom-full mb-2 w-60 bg-slate-800 text-white text-xs rounded py-1 px-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none left-1/2 -translate-x-1/2" },
                                "Añade montos específicos en fechas específicas. Déjalo vacío si no quieres añadir ninguno."
                            )
                        )
                    ),
                    React.createElement('div', { className: "space-y-3 max-h-60 overflow-y-auto pr-2" },
                        contributions.map((c, index) => (
                            React.createElement('div', { key: c.id, className: "grid grid-cols-1 sm:grid-cols-5 gap-3 items-center" },
                                React.createElement('div', { className: "sm:col-span-2" },
                                    React.createElement('input', { type: "date", value: c.date, onChange: e => handleContributionChange(c.id, 'date', e.target.value), className: "w-full bg-slate-100 dark:bg-[#0A0E17] border-2 border-slate-200 dark:border-slate-700 rounded-lg p-3 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition", 'aria-label': "Contribution Date" })
                                ),
                                React.createElement('div', { className: "sm:col-span-2" },
                                    React.createElement('input', { type: "number", value: c.amount, onChange: e => handleContributionChange(c.id, 'amount', e.target.value), placeholder: "Monto", className: "w-full bg-slate-100 dark:bg-[#0A0E17] border-2 border-slate-200 dark:border-slate-700 rounded-lg p-3 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition", 'aria-label': "Contribution Amount" })
                                ),
                                React.createElement('div', { className: "sm:col-span-1 flex justify-end" },
                                    contributions.length > 1 && (
                                        React.createElement('button', { onClick: () => handleRemoveContribution(c.id), className: "p-2 text-red-500 hover:bg-red-500/10 rounded-full transition-colors", 'aria-label': "Remove contribution" },
                                            React.createElement(Trash2, { size: 18 })
                                        )
                                    )
                                )
                            )
                        ))
                    ),
                    React.createElement('button', { onClick: handleAddContribution, className: "mt-3 text-sm font-semibold text-emerald-600 dark:text-emerald-400 hover:underline flex items-center gap-1" },
                        React.createElement(Plus, { size: 16 }), " Añadir Aporte"
                    )
                ),
                React.createElement('div', { className: "mt-6 border-t border-slate-200 dark:border-slate-700 pt-6" },
                    React.createElement('div', { className: "flex items-center" },
                        React.createElement('input', { type: "checkbox", id: "considerTaxes", checked: considerTaxes, onChange: e => setConsiderTaxes(e.target.checked), className: "h-4 w-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500" }),
                        React.createElement('label', { htmlFor: "considerTaxes", className: "ml-3 block text-sm font-medium text-slate-700 dark:text-slate-300" },
                            "Considerar 10% de comisión sobre ganancias (aprox. para intercambios y retiros)."
                        )
                    )
                ),
                React.createElement('div', { className: "mt-8 flex flex-col sm:flex-row gap-4" },
                    React.createElement('button', { onClick: handleCalculate, className: "flex-1 w-full justify-center text-white bg-gradient-to-r from-emerald-500 to-blue-500 hover:from-emerald-600 hover:to-blue-600 font-semibold py-3 px-6 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg flex items-center gap-2" },
                        React.createElement(BarChart3, { size: 20 }), " Calcular Proyección"
                    ),
                    React.createElement('button', { onClick: handleReset, className: "flex-1 w-full justify-center bg-slate-200 dark:bg-[#1A1F35] text-slate-600 dark:text-slate-300 border border-slate-300 dark:border-[#2D3548] hover:border-slate-400 dark:hover:border-slate-500 font-semibold py-3 px-6 rounded-lg transition-all duration-300 flex items-center gap-2" },
                       React.createElement(Eraser, { size: 20 }), " Limpiar Formulario"
                    )
                )
            ),
            results && React.createElement(ResultsDisplay, { results: results })
        )
    );
};

// --- Inlined from components/GoalTab.tsx ---
const GoalTab = () => {
    const [initial, setInitial] = useState('1000');
    const [target, setTarget] = useState('10000');
    const [contribution, setContribution] = useState('100');
    const [result, setResult] = useState(null);
    const [error, setError] = useState('');

    const calculateGoal = () => {
        const initialAmount = parseFloat(initial);
        const targetAmount = parseFloat(target);
        const contributionAmount = parseFloat(contribution) || 0;

        if (isNaN(initialAmount) || initialAmount <= 0 || isNaN(targetAmount) || targetAmount <= initialAmount) {
            setError('Por favor, introduce valores válidos. La meta debe ser mayor que el monto inicial.');
            setResult(null);
            return;
        }
        setError('');

        const GOAL_INTEREST_RATE = 0.24;
        let capital = initialAmount;
        let periods = 0;
        const maxPeriods = 240; // 20 years safety limit

        while (capital < targetAmount && periods < maxPeriods) {
            periods++;
            const earnings = capital * GOAL_INTEREST_RATE;
            capital = capital + earnings + contributionAmount;
        }

        if (periods >= maxPeriods) {
             setError('La meta parece demasiado lejana con los parámetros actuales. Considera aumentar tu aporte o ajustar la meta.');
             setResult(null);
        } else {
            setResult({ periods, months: Math.round(periods * (28/30.44)) });
        }
    };

    return (
        React.createElement('div', { id: "goal-tab" },
            React.createElement(Card, null,
                React.createElement('h2', { className: "text-2xl font-bold text-center mb-6 text-slate-900 dark:text-slate-100" }, "🎯 Planificador de Metas"),
                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-6" },
                    React.createElement(InputGroup, { label: "Monto Inicial" },
                        React.createElement('input', { type: "number", value: initial, onChange: (e) => setInitial(e.target.value), placeholder: "Ej: 1000", className: "w-full" })
                    ),
                    React.createElement(InputGroup, { label: "Monto Meta" },
                        React.createElement('input', { type: "number", value: target, onChange: (e) => setTarget(e.target.value), placeholder: "Ej: 10000", className: "w-full" })
                    ),
                    React.createElement(InputGroup, { label: "Aporte por Período" },
                        React.createElement('input', { type: "number", value: contribution, onChange: (e) => setContribution(e.target.value), placeholder: "Ej: 100", className: "w-full" })
                    )
                ),
                React.createElement('button', { onClick: calculateGoal, className: "mt-8 w-full justify-center text-white bg-gradient-to-r from-emerald-500 to-blue-500 hover:from-emerald-600 hover:to-blue-600 font-semibold py-3 px-6 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg flex items-center gap-2" },
                    React.createElement(Calculator, { size: 20 }), " Calcular Tiempo Necesario"
                ),
                error && React.createElement('p', { className: "text-center text-red-500 mt-4" }, error),
                result && (
                    React.createElement('div', { className: "mt-8 text-center bg-slate-100 dark:bg-[#0A0E17] p-6 rounded-xl border border-slate-200 dark:border-slate-700" },
                        React.createElement('p', { className: "text-slate-600 dark:text-slate-400" }, "Necesitarás aproximadamente:"),
                        React.createElement('p', { className: "text-5xl font-bold my-2 bg-clip-text text-transparent bg-gradient-to-r from-emerald-400 to-blue-500" },
                            result.periods
                        ),
                        React.createElement('p', { className: "text-slate-600 dark:text-slate-400" }, "períodos (de 28 días cada uno)"),
                        React.createElement('p', { className: "text-sm text-slate-500 dark:text-slate-400 mt-2" },
                            "Que son aproximadamente ", React.createElement('strong', null, result.months), " meses."
                        )
                    )
                )
            )
        )
    );
};

// --- Inlined from components/HistoryTab.tsx ---
const HistoryTab = ({ history, clearHistory, loadFromHistory }) => {
    return (
        React.createElement('div', { id: "history-tab" },
            React.createElement(Card, null,
                React.createElement('div', { className: "flex justify-between items-center mb-6" },
                    React.createElement('h2', { className: "text-2xl font-bold text-slate-900 dark:text-slate-100" }, "📜 Historial de Cálculos"),
                    history.length > 0 && (
                        React.createElement('button', {
                            onClick: clearHistory,
                            className: "text-sm font-semibold text-red-500 hover:text-red-700 dark:hover:text-red-400 flex items-center gap-1.5"
                        },
                            React.createElement(Trash2, { size: 16 }), " Limpiar Todo"
                        )
                    )
                ),
                history.length === 0 ? (
                    React.createElement('p', { className: "text-center text-slate-500 dark:text-slate-400 py-10" }, "Aún no hay cálculos guardados.")
                ) : (
                    React.createElement('div', { className: "space-y-4" },
                        history.map(item => (
                            React.createElement('div', {
                                key: item.id,
                                onClick: () => loadFromHistory(item),
                                className: "bg-slate-100 dark:bg-slate-800/50 p-4 rounded-lg border border-slate-200 dark:border-slate-700 cursor-pointer hover:border-emerald-500 dark:hover:border-emerald-500 hover:bg-slate-200 dark:hover:bg-slate-800 transition-all duration-200"
                            },
                                React.createElement('div', { className: "flex justify-between items-center" },
                                    React.createElement('div', null,
                                        React.createElement('p', { className: "font-semibold text-slate-800 dark:text-slate-100" },
                                            formatCurrency(parseFloat(item.params.initialAmount)),
                                            React.createElement('span', { className: "mx-2 text-slate-400" }, "→"),
                                            formatCurrency(item.result.finalCapital)
                                        ),
                                        React.createElement('p', { className: "text-xs text-slate-500 dark:text-slate-400 mt-1" },
                                            formatDate(item.date)
                                        )
                                    ),
                                    React.createElement('div', { className: "text-right" },
                                        React.createElement('p', { className: `font-bold ${item.result.roi >= 0 ? 'text-emerald-500' : 'text-red-500'}` },
                                            `${item.result.roi.toFixed(2)}% ROI`
                                        ),
                                        React.createElement('p', { className: "text-xs text-slate-500 dark:text-slate-400 mt-1" },
                                            `${item.params.duration} períodos`
                                        )
                                    )
                                )
                            )
                        ))
                    )
                )
            )
        )
    );
};


// --- Inlined from App.tsx ---
const App = () => {
    // const [theme, setTheme] = useLocalStorage('theme', 'dark'); // Lógica de tema eliminada
    const [activeTab, setActiveTab] = useState('calculator');
    const [isDonateModalOpen, setDonateModalOpen] = useState(false);
    const [history, setHistory] = useLocalStorage('calculationHistory', []);
    const [historyToLoad, setHistoryToLoad] = useState(null);

    useEffect(() => {
        // Forzar modo oscuro permanentemente
        document.documentElement.classList.add('dark');
        document.documentElement.classList.remove('light');
    }, []); // El array vacío [] asegura que esto solo se ejecute una vez

    const addToHistory = (item) => {
        setHistory(prev => [item, ...prev.slice(0, 9)]);
    };

    const clearHistory = () => {
        setHistory([]);
    };

    const loadFromHistory = useCallback((item) => {
        setHistoryToLoad(item);
        setActiveTab('calculator');
    }, []);
    
    const onHistoryLoaded = useCallback(() => {
        setHistoryToLoad(null);
    }, []);

    return (
        React.createElement('div', { className: "min-h-screen text-slate-900 dark:text-slate-100 bg-slate-50 dark:bg-gradient-to-br dark:from-[#0A0E17] dark:to-[#161B2E] transition-colors duration-300" },
            React.createElement('div', { className: "app-container max-w-7xl mx-auto p-4 md:p-8" },
                React.createElement(Header, null), // Props 'theme' y 'setTheme' eliminadas
                React.createElement(Tabs, { activeTab: activeTab, setActiveTab: setActiveTab }),
                React.createElement('main', null,
                    activeTab === 'calculator' && React.createElement(CalculatorTab, { addToHistory: addToHistory, historyToLoad: historyToLoad, onHistoryLoaded: onHistoryLoaded }),
                    activeTab === 'goal' && React.createElement(GoalTab, null),
                    activeTab === 'history' && React.createElement(HistoryTab, { history: history, clearHistory: clearHistory, loadFromHistory: loadFromHistory })
                ),
                React.createElement('footer', { className: "text-center mt-8 md:mt-12 text-slate-500 dark:text-slate-400 text-sm" },
                    React.createElement('div', { className: "donate-footer py-5 border-t border-slate-200 dark:border-slate-700" },
                        React.createElement('button', {
                            onClick: () => setDonateModalOpen(true),
                            className: "bg-slate-100 dark:bg-[#1A1F35] text-slate-600 dark:text-slate-300 border border-slate-200 dark:border-[#2D3548] hover:border-emerald-500 dark:hover:border-emerald-500 hover:text-emerald-500 dark:hover:text-emerald-500 font-semibold py-2 px-6 rounded-lg transition-all duration-300 flex items-center gap-2 mx-auto"
                        },
                            React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round", className: "lucide lucide-heart" }, React.createElement('path', { d: "M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" })),
                            "Apoya esta Herramienta"
                        )
                    ),
                    React.createElement('p', { className: "mt-4" }, "Regla de oro: Nunca inviertas dinero que necesites para vivir.")
                )
            ),
            React.createElement(DonationModal, { isOpen: isDonateModalOpen, onClose: () => setDonateModalOpen(false) })
        )
    );
};

// --- Inlined from index.tsx ---
const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  React.createElement(React.StrictMode, null,
    React.createElement(App)
  )
);
// ]]>
    </script>
</body>
</html>
